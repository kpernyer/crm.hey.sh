# Infrastructure Justfile (Terraform + Kubernetes)

set dotenv-load := true

default:
    @just --list

# Install/init dependencies
install:
    cd terraform && terraform init

# Build (validate configs)
build:
    cd terraform && terraform validate
    kubectl apply --dry-run=client -f k8s/

# Run tests (validate)
test:
    cd terraform && terraform validate

# Check configs
check:
    cd terraform && terraform fmt -check
    cd terraform && terraform validate

# Deploy to environment (dev/prod)
deploy env:
    cd terraform && terraform apply -var="environment={{env}}"
    kubectl apply -f k8s/namespace.yaml
    kubectl apply -f k8s/ -n crm

# Clean (destroy resources - dangerous!)
clean:
    @echo "Run 'terraform destroy' manually for safety"
